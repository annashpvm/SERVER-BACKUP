Ext.onReady(function() {
Ext.QuickTips.init();

   var GinCompcode = localStorage.getItem('acccompcode');
   var GinFinid = localStorage.getItem('accfinid');


 var PartyDataStore = new Ext.data.Store({
      id: 'PartyDataStore',
      proxy: new Ext.data.HttpProxy({
               url: '/Financials/clsRepFinancials.php',
                method: 'POST'
            }),
            baseParams:{task: "VEND"}, // this parameter asks for listing
      reader: new Ext.data.JsonReader({
                  // we tell the datastore where to get his data from
        root: 'results',
        totalProperty: 'total',
        id: 'id'
      },[
        {name: 'vendor_code', type: 'int', mapping: 'vendor_code'},
        {name: 'vendor_name', type: 'string', mapping: 'vendor_name'}
      ]),
      sortInfo:{field: 'vendor_code', direction: "DESC"}
    });

 


var cmbParty = new Ext.form.ComboBox({
        id         : 'cmbParty',
        fieldLabel : 'Party Name',
        width      : 250,
        store      : PartyDataStore,
        displayField:'vendor_name',
        valueField:'vendor_code',
        hiddenName:'vendor_name',
        typeAhead: true,
        mode: 'local',
        forceSelection: true,
        triggerAction: 'all',
        selectOnFocus:true,
        editable: true,
        emptyText:'Select Party Name',
        listeners:{
            select :function(){
          
    }
    }

    });


var Fdate = new Ext.form.DateField(
    {
        name: 'Fdate',
        id: 'Fdate',
        format     : 'Y-m-d',
        value      : new Date(),
        fieldLabel: 'From',
        submitFormat: 'Y-m-d',
        allowBlank: false
    }
);

var Tdate = new Ext.form.DateField({
        name: 'Tdate',
        id: 'Tdate',
        format     : 'Y-m-d',
        value      : new Date(),
        fieldLabel: 'To'

    });

function partyload()
{
//Ext.Msg.alert(GinCompcode+gstoption);
PartyDataStore.removeAll();
cmbParty.setRawValue("");
PartyDataStore.load({
                      url: '/Financials/clsRepFinancials.php',
                       params: {
                           task: 'VEND',
				gincompcode :GinCompcode, 
				prefix:gstoption
                       }
                    });
}

var gstoption="S";
var gstrpttype="D";
var gstseloption="A";
var PendingMinFormPanel = new Ext.form.FormPanel({
        renderTo    : Ext.getBody(),
        xtype       : 'form',
        title       : 'Pending MIN',
        width       : 500,
        height      : 500,
       bodyStyle:{"background-color":"#3399CC"},
        frame       : false,
        id          : 'PendingMinFormPanel',
        method      : 'post',
        layout      : 'absolute',
       
        tbar: {
            xtype: 'toolbar',
            height: 40,
            fontSize:25,
            items: [
                
                {
                    text: 'Refresh',
                    style  : 'text-align:center;', icon: '/Pictures/refresh.png',
                    tooltip: 'Refresh Details...', height: 40
                },'-',

                {
                    text: 'View',
                    style  : 'text-align:center;', icon: '/Pictures/view.png',
                    tooltip: 'View Details...', height: 40,
                    listeners:{
                     click:
                        function () {
                    var form = PendingMinFormPanel.getForm();
                    if (form.isValid()) {

                    var fdate=Ext.getCmp('Fdate').value;
                    var tdate=Ext.getCmp('Tdate').value;
                    var d1 =  fdate + " 00:00:00.000";
                    var d2 =  tdate + " 00:00:00.000";
//                    var compcode=1;
//                    var finid=20;
                    var postatus='N';
                    var notop='NOT'
                    var vencode=0;

                    var comp="&compcode="+encodeURIComponent(GinCompcode);
                    var fin = "&minfinid="+encodeURIComponent(GinFinid);
                    var fd = "&from_date="+encodeURIComponent(d1);
                    var td = "&to_date="+encodeURIComponent(d2);
                    var sts = "&postatus="+encodeURIComponent(postatus);
                    var top = "&notop="+encodeURIComponent(notop);
                    var vcode = "&vencode="+encodeURIComponent(vencode);
		var fg = "&flag=" + encodeURIComponent(gstseloption);
                     var test = (comp+fin+fd+td+sts+top+vcode) ;
                     if (gstoption=='S')
                     {
			if (gstrpttype=="C")
			{
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepConsolidatedPendingMINDetails.rptdesign'+test,  '_blank' );
			}
			else if (gstrpttype=="P")
			{
	                var vencode=Ext.getCmp("cmbParty").getValue();
			var vcode = "&vencode="+encodeURIComponent(vencode);
			var test = (comp+fin+fd+td+sts+top+vcode) ;
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPartywisePendingMINDetails.rptdesign'+test,  '_blank' );
			}
			else
			{
	                var test = (comp+fin+fd+td+sts+top+vcode+fg) ;
			if (GinCompcode=="1")
			{
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPendingMINDetails.rptdesign'+test,  '_blank' );
			}
			else
			{
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPendingMINDetailsNew.rptdesign'+test,  '_blank' );
			}
			}
                     }
			else if (gstoption=="Y")
                     {
                     var test = (comp+fin+fd+td) ;
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPendingMINDetailsYarn.rptdesign'+test,  '_blank' );
                     }
                    else if (gstoption=="F")
                     {
			if (gstrpttype=="P")
			var party=Ext.getCmp("cmbParty").getRawValue();
			else
			var party="%";
                    var pt = "&party="+encodeURIComponent(party);
                     var test = (comp+fin+fd+td+pt) ;
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPendingMINDetailsFabric.rptdesign'+test,  '_blank' );
                     }
		 else if (gstoption=="M")
                     {
			if (GinCompcode=="1")
			{
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPendingMINDetailsMadeups.rptdesign'+test,  '_blank' );
			}
			else
			{
window.open('http://kgsoft.kgdenim.com:8080/birt-viewer/frameset?__report=accounts/AccRepPendingMINDetailsMadeupsNew.rptdesign'+test,  '_blank' );
			}
                     }
                    }
                    }
                    }


                 },'-',

                {
                    text: 'Exit',
                    style  : 'text-align:center;', icon: '/Pictures/exit.png',
                    tooltip: 'Close...', height: 40,
                    listeners:{
                        click: function(){
                            PendingMinWindow.hide();
                        }
                    }
                }
                ]

            },
         items:[
                {xtype: 'fieldset',
                title: 'Type',
                layout : 'hbox',
                border:true,
                height:80,
                width:450,
                layout      : 'absolute',
                x: 10,
                y: 10,
             items:[
                {
                xtype   : 'radiogroup',
                border  :  false,
                x       : 0,
                y       : 0,
                columns : 2,
                items: [
                    {boxLabel: 'Stores', name: 'OptType', id:'optStores',inputValue: 1,checked: true,
                    listeners:{
                    'check':function(rb,checked){
                     if(checked==true){
                         gstoption="S";
partyload();
                     }
                     }
                     }
                    },
                    {boxLabel: 'Fabric', name: 'OptType',id:'optFabric', inputValue: 2,
                    listeners:{
                    'check':function(rb,checked){
                     if(checked==true){
                         gstoption="F";
partyload();
                     }
                     }
                     }
                    },
                    {boxLabel: 'Yarn', name: 'OptType', id:'optYarn',inputValue:3,
                    listeners:{
                    'check':function(rb,checked){
                     if(checked==true){
                         gstoption="Y";
partyload();
                     }
                     }
                     }
                    },
                    {boxLabel: 'Madeups', name: 'OptType', id:'optMadeups',inputValue:4,
                    listeners:{
                    'check':function(rb,checked){
                     if(checked==true){
                         gstoption="M";
partyload();
                     }
                     }
                     }
                    }
                   ]
                }
                ]
              },
               {xtype: 'fieldset',
                title: 'Date',
                layout : 'hbox',
                border:true,
                height:80,
                width:450,
                layout      : 'absolute',
                x: 10,
                y: 90,
             items:[
                { xtype       : 'fieldset',
                title       : '',
                x           : 0,
                y           : 0,
                border      : false,
                labelWidth  : 70,
                items: [Fdate]
                },
                { xtype       : 'fieldset',
                title       : '',
                x           : 220,
                y           : 0,
                border      : false,
                labelWidth  : 70,
                items: [Tdate]
                }
                ]
              },
               {xtype: 'fieldset',
                title: 'Report Type',
                layout : 'vbox',
                border:true,
                height:100,
                width:450,
                layout      : 'absolute',
                x: 10,
                y: 170,
             items:[
                    {
                    xtype   : 'radiogroup',
                    border  :  false,
                    x       : 0,
                    y       : 0,
                    columns : 3,
                    items: [
                        {boxLabel: 'Detailed', name: 'OptRptType', id:'optDetailed',inputValue: 1,checked: true,
                        listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstrpttype="D";
                         }
                        }
                        }
                        },
                        {boxLabel: 'Consolidated', name: 'OptRptType',id:'optConsolidated', inputValue: 2,
                         listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstrpttype="C";
                         }
                        }
                        }
                        },
                        {boxLabel: 'PartyWise', name: 'OptRptType', id:'optParty',inputValue:3,
                         listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstrpttype="P";
                         }
                        }
                        }
                        }
                       ]
                    },
                { xtype     : 'fieldset',
                title       : '',
                width       : 400,
                x           : 10,
                y           : 30,
                border      : false,
                labelWidth  : 85,
                items: [cmbParty]
                }
                ]
                },
                {xtype: 'fieldset',
                title: 'Options',
                layout : 'vbox',
                border:true,
                height:110,
                width:450,
                layout      : 'absolute',
                x: 10,
                y: 275,
                items:[
                {
                xtype   : 'radiogroup',
                border  :  false,
                x       : 0,
                y       : 0,
                columns : 2,
                items: [
                    {boxLabel: 'All', name: 'OptInvType', id:'optAll',inputValue: 1,checked: true,
                     listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstseloption="A";
                         }
                        }
                        }
                    },
                    {boxLabel: 'Not Invoiced', name: 'OptInvType',id:'optNotInv', inputValue: 2,
                     listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstseloption="B";
                         }
                        }
                        }
                    },
                    {boxLabel: 'Not Given To A/C', name: 'OptInvType', id:'optNotGiven',inputValue:3,
                     listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstseloption="C";
                         }
                        }
                        }
                    },
                    {boxLabel: 'UnAccounted', name: 'OptInvType', id:'optUnAccounted',inputValue:4,
                     listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstseloption="D";
                         }
                        }
                        }
                    },
                    {boxLabel: 'Un Paid Invoices', name: 'OptInvType', id:'optUnpaid',inputValue:5,
                      listeners:{
                        'check':function(rb,checked){
                         if(checked==true){
                          gstseloption="E";
                         }
                        }
                        }
                    }
                   ]
                }
                ]
                }
                
              
              ]
               });



     var PendingMinWindow = new Ext.Window({
        height      : 500,
        width       : 500,
        items       : PendingMinFormPanel,
        closable    : true,
        minimizable : true,
        maximizable : true,
        resizable   : false,
        border      : false,
        draggable   : false,
     bodyStyle:{"background-color":"#3399CC"},
        
        y      :70,
        listeners:
            {
                show:function(){
 		PartyDataStore.load({
                      url: '/Financials/clsRepFinancials.php',
                       params: {
                           task: 'VEND',
				gincompcode :GinCompcode, 
				prefix:'S'
                       }
                    });
                }
            }


    });
       PendingMinWindow.show();
});
